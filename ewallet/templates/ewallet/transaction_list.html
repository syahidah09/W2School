{% extends 'ewallet/base.html' %}

{% block title %}
<title>Transaction History</title>
{% endblock %}

{% block content2 %}
<!-- Page Header-->
<header class="bg-white shadow-sm px-4 py-3 z-index-20">
  <div class="container-fluid px-0">
    <div class="row gy-4">
      <div class="d-flex mb-0 justify-content-between align-items-center">
        <h2 class="my-0">Transaction History</h2>        
      </div>
    </div>
  </div>
</header>

<!-- Section-->
<section class="pb-0 pt-3">
  <div class="container-fluid">
    <!-- Filter Transactions -->
    <div class="row gy-4">      
      <div class="col-lg-12">
        <div class="card card-body mb-0">          
          <form action="" method="get">
            <div class="row gy-2">
              <div class="d-flex mb-0 justify-content-between align-items-center">
                <h4>Filter</h4>
                {% for filter in myFilter.form %}
                {{ filter.label_tag }}
                {{ filter }}
                {% endfor %}
                <button class="col-sm-2 btn btn-primary btn-sm" type="submit">Apply</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div><br>

    <!-- Transactions -->
    <div class="row gy-4">
      <div class="col-lg-12">
        <div class="card mb-0">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table mb-0 align-middle" style="text-align: center">
                <thead>
                  <tr>
                    <th></th>
                    <th>Date</th>
                    <th>Payer</th>
                    <th>Transaction Type</th>
                    <th>Description</th>
                    <th>Amount</th>  
                    <th></th>
                  </tr>
                </thead>
                {% for transaction in transactions %}
                <tbody>
                  <tr>
                    <td><a class="btn btn-sm btn-secondary" href="{{ transaction.get_absolute_url2 }}">View</a></td>
                    <td>{{ transaction.date|date:'d/m/Y' }}</td>
                    {% if transaction.parent is not None %}
                    <td>{{ transaction.parent }}</td>
                    {% else %}
                    <td>{{ transaction.student }}</td>
                    {% endif %}
                    <td>{{ transaction.transaction_type }}</td>
                    <td>{{ transaction.description }}</td>
                    <td>{{ transaction.amount|floatformat:2 }}</td>  
                    {% if transaction.transaction_type == 'Payment' and transaction.order is not None %} 
                    <td>
                      <a href="{% url 'ewallet:download_receipt' transaction.id %}" class="btn btn-sm btn-success">Download Receipt</a>                      
                    {% else %}
                    <td><button class="btn btn-sm btn-secondary">Receipt Unavailable</button></td> 
                    {% endif %}                            
                  </tr>
                </tbody>
                {% endfor %}
              </table>
            </div>
          </div>
        </div>
      </div>
    </div><br>

    <!-- Pagination -->
    <ul class="pagination pagination-sm">
      <li class="page-item {% if not transactions.has_previous %} disabled {% endif %}">
        <a class="page-link"
           href="{% if transactions.has_previous %} {% url 'ewallet:transactions' transactions.previous_page_number %}{% endif %} ">Previous</a>
      </li>

      {% if transactions.number|add:'-1' > 1 %}
      <li class="page-item disabled"><a class="page-link">&hellip;</a></li>
      {% endif %}

      <!-- Page numbers -->
      {% for i in transactions.paginator.page_range %}
      {% if transactions.number == i %}
      <li class="active page-item disabled"><a class="page-link" href="#">{{ i }}</a></li>
      {% elif i > transactions.number|add:'-2' and i < transactions.number|add:'2' %}
      <li class="page-item"><a class="page-link" href="{% url 'ewallet:transactions' i %}">{{ i }}</a></li>
      {% endif %}
      {% endfor %}

      {% if transactions.paginator.num_pages > transactions.number|add:'1' %}
      <li class="page-item disabled"><a class="page-link" href="#">&hellip;</a></li>
      {% endif %}

      <li class="page-item {% if not transactions.has_next %} disabled {% endif %}">
        <a class="page-link"
           href="{% if transactions.has_next %} {% url 'ewallet:transactions' transactions.next_page_number %} {% endif %}">Next</a>
      </li>

      <!-- {% if transactions.has_previous %}
      <li class="page-item">
        <a class="page-link" href="{% url 'ewallet:transactions' transactions.previous_page_number %}">Previous</a>
      </li>
      {% else %}
      <li class="page-item disabled">
        <a class="page-link" href="">Previous</a>
      </li>
      {% endif %}

      {% for i in transactions.paginator.page_range %}
      {% if transactions.number == i %}
      <li class='active mx-1'><span>{{ i }}</span></li>
      {% else %}
      <li class="mx-1"><a href="{% url 'ewallet:transactions' i %}">{{ i }}</a></li>
      {% endif %}
      {% endfor %}


      {% if transactions.has_next %}
      <li class="page-item">
        <a class="page-link" href="{% url 'ewallet:transactions' transactions.next_page_number %}">Next</a>
      </li>
      {% else %}
      <li class="page-item"><span class='disabled'>Next</span></li>
      <li class="page-item disabled">
        <a class="page-link" href="">Next</a>
      </li>
      {% endif %} -->

    </ul>


  </div>
</section>

{% endblock %}

